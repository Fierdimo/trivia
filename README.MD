# ðŸŽ® Trivia Game - Real-Time Questions and Answers with Live Ranking

<div>

![NextJS](https://img.shields.io/badge/Frontend-NextJS-white?style=for-the-badge&logo=next.js)
![MaterialUI](https://img.shields.io/badge/Style-Material%20UI-007FFF?style=for-the-badge&logo=mui&logoColor=white)

![NestJS](https://img.shields.io/badge/Backend-NestJS-red?style=for-the-badge&logo=nestjs)
![JWT](https://img.shields.io/badge/Security-JWT-pink?style=for-the-badge&logo=JSON%20web%20tokens)
![Postgres](https://img.shields.io/badge/database-postgres-%23316192.svg?style=for-the-badge&logo=postgresql&logoColor=white)

![WebSockets](https://img.shields.io/badge/WebSockets-Socket.IO-yellow?style=for-the-badge&logo=socket.io)
![Context-API](https://img.shields.io/badge/API--REST-Axios-000000?style=for-the-badge&logo=axios)

</div>

## ðŸ“š Tabla de Contenidos

- [Installation](#-installation)
- [Configuration](#-configuration)
- [Project Structure](#-estructura-del-proyecto)
- [WebSockets](#-websockets)
- [Technical Architecture](#-technical-architecture)
- [To do](#-to-do)
- [Licence](#-licence)

## ðŸ“¥ Installation

### **Backend (NestJS)**

```bash
# 1. Clone the repository
git clone https://github.com/fierdimo/trivia.git

# 2. Navigate to the backend directory
cd trivia-backend

# 3. Install dependencies
npm install

# 4. Start a PostgreSQL container
docker-compose up -d

# 5. Start the server (development mode)
npm run dev

# 6. Access the API documentation
http://localhost:3000/api


```

### **Frontend (NextJS)**

```bash
# 1. From the root of the cloned directory...
cd trivia-frontend

# 2. Install dependencies
npm install

# 3. Start the application
npm run dev

# 4. Access the website
http://localhost:3001
```

## â›ï¸ Configuration

Certain environment variables are required for the proper functioning of each part. This includes the PostgreSQL database in the backend and the default `admin` credentials. In the development environment, a `.env` file is required with the following:

### **Backend Environment Variables**

```bash
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=your_secure_password
DB_NAME=trivia_db
JWT_SECRET=my_super_secure_secret_key
ADMIN_EMAIL=admin # Default admin email
ADMIN_PASSWORD=admin # Default admin password
```

### **Frontend Environment Variables**

```bash
BK_HOSTS=http://localhost:3000
```

## **ðŸ³ Docker Containers**

Alternatively, the entire project can be installed using Docker Compose..

_From the root of the project, run `$ docker compose up -d`._

### **Estructura del proyecto**

```bash
trivia/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ .env # Only in development
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ .env # Only in development
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ README.MD
â””â”€â”€ docker-compose.yml
```

**docker-compose.yml**

```bash
services:
  # PostgreSQL Database
  db:
    image: postgres:15-alpine
    container_name: trivia_db
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: your_secure_password
      POSTGRES_DB: trivia_db
      ADMIN_EMAIL: admin
      ADMIN_PASSWORD: admin
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    networks:
      - trivia_network

  # Backend (NestJS)
  backend:
    build:
      context: ./trivia-backend
      dockerfile: Dockerfile
    container_name: trivia_backend
    environment:
      DB_HOST: db
      DB_PORT: 5432
      DB_USER: postgres
      DB_PASSWORD: your_secure_password
      DB_NAME: trivia_db
      JWT_SECRET: jwt_secret_key
    ports:
      - "3000:3000"
    depends_on:
      - db
    networks:
      - trivia_network

  # Frontend (Next.js)
  frontend:
    build:
      context: ./trivia-frontend
      dockerfile: Dockerfile
    container_name: trivia_frontend
    environment:
      BK_HOSTS: http://backend:3000
    ports:
      - "3001:3000"
    depends_on:
      - backend
    networks:
      - trivia_network

# Volumes for data persistence
volumes:
  postgres_data:

# Network to connect services
networks:
  trivia_network:
    driver: bridge
```

## ðŸ“¥ Project Structure

## **backend**

```bash
src/
â”œâ”€â”€ auth/                     # JWT Authentication
â”‚   â”œâ”€â”€ dto                   # Data Transfer Objects (DTOs) for authentication
â”‚   â”‚   â””â”€â”€ login-user.ts     # DTO for user login
â”‚   â”œâ”€â”€ jwt                   # JWT configuration and strategies
â”‚   â”‚   â””â”€â”€ strategy.ts       # JWT authentication strategy
â”‚   â”œâ”€â”€ guard.ts              # Guards (middlewares) to protect routes
â”‚   â”œâ”€â”€ controller.ts         # Controller to handle authentication endpoints
â”‚   â”œâ”€â”€ service.ts            # Business logic for authentication
â”‚   â””â”€â”€ module.ts             # Authentication module
â”‚
â”œâ”€â”€ questions/                # Question management
â”‚   â”œâ”€â”€ entities              # Database entities
â”‚   â”‚   â””â”€â”€ entity.ts         # Entity representing a question
â”‚   â”œâ”€â”€ controller.ts         # Controller to handle question endpoints
â”‚   â”œâ”€â”€ service.ts            # Business logic for questions
â”‚   â””â”€â”€ module.ts             # Questions module
â”‚
â”œâ”€â”€ scores/                   # Score management
â”‚   â”œâ”€â”€ entities              # Database entities
â”‚   â”‚   â””â”€â”€ entity.ts         # Entity representing a score
â”‚   â”œâ”€â”€ controller.ts         # Controller to handle score endpoints
â”‚   â”œâ”€â”€ service.ts            # Business logic for scores
â”‚   â””â”€â”€ module.ts             # Scores module
â”‚
â”œâ”€â”€ ranking/                  # WebSockets and ranking management
â”‚   â””â”€â”€ gateway.ts            # Socket.IO gateway for real-time communication
â”‚   â”œâ”€â”€ service.ts            # Business logic for ranking
â”‚   â””â”€â”€ module.ts             # Ranking module
â”‚
â”œâ”€â”€ roles/                    # Role and permission management
â”‚   â”œâ”€â”€ decorator.ts          # Custom role decorators
â”‚   â””â”€â”€ guard.ts              # Guards to verify roles and permissions
â”‚
â”œâ”€â”€ users/                    # User management
â”‚   â”œâ”€â”€ entities              # Database entities
â”‚   â”‚   â”œâ”€â”€ uuid-param.ts     # DTO for UUID parameters
â”‚   â”‚   â””â”€â”€ entity.ts         # Entity representing a user
â”‚   â”œâ”€â”€ dto                   # Data Transfer Objects (DTOs) for users
â”‚   â”‚   â””â”€â”€ register-user.ts  # DTO for user registration
â”‚   â”œâ”€â”€ controller.ts         # Controller to handle user endpoints
â”‚   â”œâ”€â”€ service.ts            # Business logic for users
â”‚   â””â”€â”€ module.ts             # Users module
â”‚
â”œâ”€â”€ app.module.ts             # Main application module
â””â”€â”€ main.ts                   # Application entry point
```

## **frontend**

```bash
src/
â”œâ”€â”€ components/            # Reusable UI components
â”‚   â”œâ”€â”€ header.tsx         # Application header component
â”‚   â”œâ”€â”€ loginBox.tsx       # Login form
â”‚   â”œâ”€â”€ newQuestion.tsx    # Form to create new questions
â”‚   â”œâ”€â”€ question.tsx       # Component to display a single question
â”‚   â”œâ”€â”€ questions.tsx      # List of questions
â”‚   â””â”€â”€ ranking.tsx        # Component to display real-time ranking
â”‚
â”œâ”€â”€ context/               # React contexts for global state management
â”‚   â””â”€â”€ userContext.tsx    # Context to store user data
â”‚
â”œâ”€â”€ hooks/                 # Custom hooks
â”‚   â”œâ”€â”€ useAuth.tsx        # Hook to handle authentication logic
â”‚   â”œâ”€â”€ useCategories.tsx  # Hook to fetch and manage categories
â”‚   â”œâ”€â”€ useQuestions.tsx   # Hook to fetch and manage questions
â”‚   â””â”€â”€ useRankings.tsx    # Hook to fetch and manage ranking
â”‚
â”œâ”€â”€ pages/                 # Application pages (Next.js routing)
â”‚   â”œâ”€â”€ _app.tsx           # Main page wrapping the entire application (common layout)
â”‚   â”œâ”€â”€ _document.tsx      # Customization of the base HTML document
â”‚   â”œâ”€â”€ game/              # Pages related to the interactive game
â”‚   â”‚   â”œâ”€â”€ [newQuestion]  # Dialog to create new questions (Only for 'admin' user).
â”‚   â”‚   â”œâ”€â”€ [questions]    # Uses the `questions.tsx' component
â”‚   â”‚   â”œâ”€â”€ [categories]   # List of available question categories
â”‚   â”‚   â””â”€â”€ [rankings]     # Uses the `ranking.tsx' component
â”‚   â””â”€â”€ index.tsx          # Home page (landing page)
â”‚
â”œâ”€â”€ styles/                # Global styles and CSS
â”‚   â””â”€â”€ globals.css        # Global styles file for the application
â”‚
â””â”€â”€ types/                 # TypeScript types and interfaces
    â””â”€â”€ user.ts            # Definition of user-related types/interfaces
```

## âš¡ Websockets

```mermaid
sequenceDiagram
participant Frontend
participant Backend
participant DB

    Frontend->>Backend: POST /scores (sends score)
    Backend->>DB: Updates score
    Backend->>Backend: Recalculates ranking
    Backend->>Frontend: Emits "rankingUpdated"
    Frontend->>Frontend: Updates UI
```

### Explanation:

1. Frontend sends a score to the **Backend** via a `POST /scores` request.
2. The **Backend** updates the score in the database (**DB**).
3. The **Backend** recalculates the ranking..
4. The **Backend** emits a `"rankingUpdated"` event to the Frontend.
5. The **Frontend** updates the user interface **(UI)** with the new information.

### **Key Implementation**

#### Backend: ranking.gateway.ts

```bash
@WebSocketGateway({ cors: true })
export class RankingGateway {
  @WebSocketServer()
  server: Server;

  @SubscribeMessage('scoreUpdate')
  handleScoreUpdate() {
    this.server.emit('rankingUpdated', await this.getLatestRanking());
  }
}
```

#### Frontend: useRanking.ts

```bash
const socket = io(process.env.NEXT_PUBLIC_WS_URL!);

socket.on('rankingUpdated', (newRanking: RankingEntry[]) => {
  setRanking(newRanking);
});
```

## ðŸ§  Technical Architecture

### **Backend**

| Technology      | Purpose                   | Key Benefit Clave                     |
| --------------- | ------------------------- | ------------------------------------- |
| NestJS          | Main framework            | Modular and scalable architecture     |
| TypeORM         | ORM for PostgreSQL        | Advanced migrations and relationships |
| Socket.IO       | Real-time communication   | Low latency (~100ms)                  |
| Class-Validator | Data validation           | TypeScript-like schemas               |
| JWT             | AutenticaciÃ³n de usuarios | EspiraciÃ³n de la sesiÃ³n               |

# **Frontend**

| Technology     |       Purpose        |        Key Benefit        |
| -------------- | :------------------: | :-----------------------: |
| Next.js 15     |   Hybrid rendering   |    Optimized SEO + ISR    |
| Axios          | API state management | Simple and consistent API |
| Material-UI v6 |    UI components     |     Responsive design     |

# To Do

The frontend design is still raw and only shows essential functionality. It is necessary to create user-friendly components and ensure compatibility with devices of different screen sizes (responsive design).

# License

This project is licensed under the terms of the MIT License

![License](https://img.shields.io/badge/license-MIT-green)
